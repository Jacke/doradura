# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Callback –ö–Ω–æ–ø–æ–∫ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥ `/analytics`, `/health`, `/metrics`, `/revenue` –∫–Ω–æ–ø–∫–∏ inline keyboard –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ - –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –Ω–∏—Ö –Ω–µ –≤—ã–∑—ã–≤–∞–ª–æ –Ω–∏–∫–∞–∫–æ–π —Ä–µ–∞–∫—Ü–∏–∏.

## –ü—Ä–∏—á–∏–Ω–∞

–í—Å–µ callback queries –≤ –±–æ—Ç–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `handle_menu_callback` –≤ [src/telegram/menu.rs](src/telegram/menu.rs). –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pattern matching –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É callback data:

```rust
if data.starts_with("ae:") {
    // Audio extraction callbacks
} else if data.starts_with("mode:") {
    // Mode selection callbacks
} else if data.starts_with("admin:") {
    // Admin panel callbacks
}
```

–ö–Ω–æ–ø–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å—ã `"analytics:"` –∏ `"metrics:"`, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç—Ç–∏—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ `handle_menu_callback`:

### 1. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `analytics:*` (—Å—Ç—Ä–æ–∫–∏ 1993-2046)

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

- **`analytics:refresh`** - –û–±–Ω–æ–≤–ª—è–µ—Ç dashboard —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  - –í—ã–∑—ã–≤–∞–µ—Ç `generate_analytics_dashboard`
  - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–º–∏ –∂–µ –∫–Ω–æ–ø–∫–∞–º–∏

- **`analytics:details`** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–µ—Ç—Ä–∏–∫
  - –°–æ–∑–¥–∞–µ—Ç inline keyboard —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (Performance, Business, Engagement)
  - –ö–Ω–æ–ø–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ `metrics:*` callbacks

- **`analytics:close`** - –£–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –í—ã–∑—ã–≤–∞–µ—Ç `bot.delete_message()`

### 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `metrics:*` (—Å—Ç—Ä–æ–∫–∏ 2047-2073)

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:

- **`metrics:performance`** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **`metrics:business`** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- **`metrics:engagement`** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏

–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
- –í—ã–∑—ã–≤–∞—é—Ç `generate_metrics_report` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–Ω–æ–ø–∫—É "üîô –ö –æ–±—â–µ–π –ø–∞–Ω–µ–ª–∏" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É dashboard

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–û–±–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:

```rust
let admin_username = ADMIN_USERNAME.as_str();
let is_admin = !admin_username.is_empty() && q.from.username.as_deref() == Some(admin_username);

if !is_admin {
    bot.send_message(chat_id, "‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")
        .await?;
    return Ok(());
}
```

## –§–∞–π–ª—ã –ò–∑–º–µ–Ω–µ–Ω—ã

- [src/telegram/menu.rs](src/telegram/menu.rs) (—Å—Ç—Ä–æ–∫–∏ 1993-2073)
  - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `analytics:*` callbacks
  - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `metrics:*` callbacks

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `cargo run --release`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/analytics` (–æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–Ω–æ–ø–∫–∏:
   - ‚úÖ "üîÑ –û–±–Ω–æ–≤–∏—Ç—å" - –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å dashboard
   - ‚úÖ "üìä –î–µ—Ç–∞–ª–∏" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - ‚úÖ "üîô –ó–∞–∫—Ä—ã—Ç—å" - –¥–æ–ª–∂–µ–Ω —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
4. –í –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ "‚ö° Performance" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - ‚úÖ "üí∞ Business" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
   - ‚úÖ "üë• Engagement" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏
   - ‚úÖ "üîô –ù–∞–∑–∞–¥" - –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É dashboard

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Callback Flow

```
/analytics command
    ‚Üì
generate_analytics_dashboard()
    ‚Üì
Message with inline keyboard:
    [üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [üìä –î–µ—Ç–∞–ª–∏]
    [üîô –ó–∞–∫—Ä—ã—Ç—å]
    ‚Üì
User clicks button ‚Üí CallbackQuery
    ‚Üì
handle_menu_callback() receives query
    ‚Üì
    ‚îú‚îÄ "analytics:refresh" ‚Üí Re-generate dashboard
    ‚îú‚îÄ "analytics:details" ‚Üí Show category menu
    ‚îÇ       ‚Üì
    ‚îÇ   [‚ö° Performance] [üí∞ Business] [üë• Engagement] [üîô –ù–∞–∑–∞–¥]
    ‚îÇ       ‚Üì
    ‚îÇ   User clicks category ‚Üí "metrics:performance"
    ‚îÇ       ‚Üì
    ‚îÇ   generate_metrics_report(category)
    ‚îÇ       ‚Üì
    ‚îÇ   Show detailed metrics + [üîô –ö –æ–±—â–µ–π –ø–∞–Ω–µ–ª–∏]
    ‚îÇ
    ‚îî‚îÄ "analytics:close" ‚Üí Delete message
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§—É–Ω–∫—Ü–∏–∏ `generate_analytics_dashboard` –∏ `generate_metrics_report` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ `src/telegram/analytics.rs` —Å –≤–∏–¥–∏–º–æ—Å—Ç—å—é `pub(crate)`
- –ù–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –∏–∑–º–µ–Ω—è—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã –≤ `src/telegram/mod.rs`
- –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
- –í—Å–µ callback queries —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –§–∞–π–ª—ã

- [TELEGRAM_ANALYTICS_INTEGRATION.md](TELEGRAM_ANALYTICS_INTEGRATION.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥
- [HOW_TO_VIEW_METRICS.md](HOW_TO_VIEW_METRICS.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –º–µ—Ç—Ä–∏–∫
- [src/telegram/analytics.rs](src/telegram/analytics.rs) - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
