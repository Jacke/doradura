# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã yt-dlp

–°–æ–∑–¥–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ yt-dlp.

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

1. ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è yt-dlp, ffmpeg, ffprobe
2. ‚úÖ **–í–µ—Ä—Å–∏—è yt-dlp** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–∏
3. ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è cookies** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ
5. ‚úÖ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ** - –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
6. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö URL
7. ‚úÖ **–†–∞–∑–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞** - —Ç–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –±–∏—Ç—Ä–µ–π—Ç–∞–º–∏
8. ‚úÖ **–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

#### 1. –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–º)

```bash
cargo test --test ytdlp_integration_test test_full_diagnostics -- --nocapture
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∂–µ—Ç:
- –ö–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ö–∞–∫–∏–µ –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ª–∏ cookies
- –ì–æ—Ç–æ–≤–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –∫ —Ä–∞–±–æ—Ç–µ

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
cargo test --test ytdlp_integration_test test_ytdlp_installed -- --nocapture
cargo test --test ytdlp_integration_test test_ytdlp_version -- --nocapture
cargo test --test ytdlp_integration_test test_cookies_configuration -- --nocapture
```

#### 3. –¢–µ—Å—Ç—ã —Å–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º (—Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)

‚ö†Ô∏è –≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `#[ignore]` - –∏—Ö –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —è–≤–Ω–æ —Å —Ñ–ª–∞–≥–æ–º `--ignored`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
cargo test --test ytdlp_integration_test test_ytdlp_get_metadata --ignored -- --nocapture

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ
cargo test --test ytdlp_integration_test test_ytdlp_download_audio --ignored -- --nocapture

# –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
cargo test --test ytdlp_integration_test test_ytdlp_invalid_url --ignored -- --nocapture

# –¢–µ—Å—Ç —Ä–∞–∑–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤
cargo test --test ytdlp_integration_test test_ytdlp_different_qualities --ignored -- --nocapture
```

#### 4. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –∫—Ä–æ–º–µ ignored
cargo test --test ytdlp_integration_test -- --nocapture --test-threads=1

# –í–°–ï —Ç–µ—Å—Ç—ã –≤–∫–ª—é—á–∞—è ignored (–¥–æ–ª–≥–æ, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
cargo test --test ytdlp_integration_test --ignored -- --nocapture --test-threads=1
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

```bash
# macOS
brew install ffmpeg
pip3 install -U yt-dlp

# Linux (Debian/Ubuntu)
sudo apt install ffmpeg
pip3 install -U yt-dlp
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cookies (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è YouTube)

**–í–∞—Ä–∏–∞–Ω—Ç A: –§–∞–π–ª cookies (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è macOS)**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "Get cookies.txt LOCALLY" –≤ Chrome
2. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ youtube.com –∏ –∑–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí Export ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `youtube_cookies.txt`
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export YTDL_COOKIES_FILE=./youtube_cookies.txt
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (Linux)**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install keyring pycryptodomex

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export YTDL_COOKIES_BROWSER=chrome
```

‚ö†Ô∏è **macOS**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç Full Disk Access –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª!

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
cargo test --test ytdlp_integration_test test_cookies_configuration -- --nocapture
```

–ï—Å–ª–∏ —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É - cookies –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç

```
running 1 test
=== –¢–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ ===
‚úì –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª cookies: ./youtube_cookies.txt
‚úì –§–∞–π–ª —Å–æ–∑–¥–∞–Ω: "/tmp/doradura_ytdlp_tests/test_audio.mp3"
‚úì –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 245632 –±–∞–π—Ç (0.23 MB)
‚úì –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω
test test_ytdlp_download_audio ... ok
```

#### ‚ùå –û—à–∏–±–∫–∞: Cookies –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

```
‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:
ERROR: [youtube] u88Y_eedNKU: Please sign in

üî¥ –ü–†–û–ë–õ–ï–ú–ê: –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
üí° –†–ï–®–ï–ù–ò–ï:
   1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
   2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: export YTDL_COOKIES_FILE=./youtube_cookies.txt
   3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
```

**–†–µ—à–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cookies (—Å–º. –≤—ã—à–µ)

#### ‚ùå –û—à–∏–±–∫–∞: PO Token

```
WARNING: [youtube] ios client requires a GVS PO Token

üî¥ –ü–†–û–ë–õ–ï–ú–ê: –¢—Ä–µ–±—É–µ—Ç—Å—è PO Token (–Ω–æ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ YouTube)
üí° –†–ï–®–ï–ù–ò–ï:
   1. –û–±–Ω–æ–≤–∏—Ç–µ yt-dlp: pip3 install -U yt-dlp
   2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ cookies
```

**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ yt-dlp –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

#### ‚ùå –û—à–∏–±–∫–∞: HTTP 403

```
üî¥ –ü–†–û–ë–õ–ï–ú–ê: YouTube –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å (–æ–±–Ω–∞—Ä—É–∂–µ–Ω –±–æ—Ç)
üí° –†–ï–®–ï–ù–ò–ï:
   1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ cookies
   2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π player_client
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cookies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CI/CD

–î–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ `#[ignore]`):

```bash
# –í .github/workflows/rust.yml –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–º
cargo test --test ytdlp_integration_test test_ytdlp_installed
cargo test --test ytdlp_integration_test test_ytdlp_version
cargo test --test ytdlp_integration_test test_full_diagnostics
```

–¢–µ—Å—Ç—ã —Å–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –ª—É—á—à–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ª–æ–∫–∞–ª—å–Ω–æ.

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö —Ç–µ—Å—Ç–æ–≤

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ `tests/ytdlp_integration_test.rs`:

```rust
#[test]
#[ignore] // –ï—Å–ª–∏ —Ç–µ—Å—Ç —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
fn test_my_feature() {
    // ... –≤–∞—à –∫–æ–¥ —Ç–µ—Å—Ç–∞
}
```

### Troubleshooting

#### –¢–µ—Å—Ç –∑–∞–≤–∏—Å–∞–µ—Ç

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `--test-threads=1`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ yt-dlp: `killall yt-dlp`

#### –§–∞–π–ª—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞

–¢–µ—Å—Ç—ã –æ—á–∏—â–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `/tmp/doradura_ytdlp_tests/`

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
```bash
rm -rf /tmp/doradura_ytdlp_tests/
```

#### "yt-dlp –Ω–µ –Ω–∞–π–¥–µ–Ω"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PATH
which yt-dlp

# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
pip3 install yt-dlp

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- üìñ [MACOS_COOKIES_FIX.md](MACOS_COOKIES_FIX.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ cookies –Ω–∞ macOS
- üìñ [YOUTUBE_COOKIES.md](YOUTUBE_COOKIES.md) - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ cookies –¥–ª—è YouTube
- üìñ [FIX_YOUTUBE_ERRORS.md](FIX_YOUTUBE_ERRORS.md) - –†–µ—à–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

### –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `test_full_diagnostics` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–≤–æ–¥
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é yt-dlp: `yt-dlp --version`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cookies —Ñ–∞–π–ª –Ω–µ –ø—É—Å—Ç–æ–π: `ls -lh youtube_cookies.txt`

