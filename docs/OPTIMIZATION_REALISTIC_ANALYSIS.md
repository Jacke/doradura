# üîç –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

## –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏

---

## 1. Arc<str> –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö (DownloadTask)

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

```rust
pub struct DownloadTask {
    pub id: String,           // ~36 –±–∞–π—Ç (UUID)
    pub url: String,          // ~50-200 –±–∞–π—Ç (–æ–±—ã—á–Ω–æ)
    pub format: String,       // ~3-4 –±–∞–π—Ç–∞ ("mp3", "mp4")
    // ...
}
```

### –ö–æ–≥–¥–∞ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è:
- ‚ùå **–í –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ**: `task.clone()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **0 —Ä–∞–∑** - –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è
- ‚úÖ **–í —Ç–µ—Å—Ç–∞—Ö**: `task.clone()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **2 —Ä–∞–∑–∞** (—Ç–µ—Å—Ç—ã –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã)
- ‚úÖ **–í –æ—á–µ—Ä–µ–¥–∏**: –ó–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `VecDeque` (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –Ω–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ß—Ç–æ –¥–∞—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

**–¢–µ–∫—É—â–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ –∑–∞–¥–∞—á—É:**
- `id`: 36 –±–∞–π—Ç
- `url`: ~100 –±–∞–π—Ç (—Å—Ä–µ–¥–Ω–∏–π YouTube URL)
- `format`: 4 –±–∞–π—Ç–∞
- **–ò—Ç–æ–≥–æ: ~140 –±–∞–π—Ç –Ω–∞ –∑–∞–¥–∞—á—É**

**–ü–æ—Å–ª–µ Arc<str>:**
- `id`: 8 –±–∞–π—Ç (Arc) + 36 –±–∞–π—Ç (–¥–∞–Ω–Ω—ã–µ) = 44 –±–∞–π—Ç–∞ (–Ω–æ –¥–µ–ª–∏—Ç—Å—è –º–µ–∂–¥—É –∫–ª–æ–Ω–∞–º–∏)
- `url`: 8 –±–∞–π—Ç (Arc) + 100 –±–∞–π—Ç = 108 –±–∞–π—Ç (–Ω–æ –¥–µ–ª–∏—Ç—Å—è)
- `format`: 8 –±–∞–π—Ç (Arc) + 4 –±–∞–π—Ç–∞ = 12 –±–∞–π—Ç (–Ω–æ –¥–µ–ª–∏—Ç—Å—è)
- **–ò—Ç–æ–≥–æ: ~164 –±–∞–π—Ç–∞ –Ω–∞ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, –Ω–æ –∫–∞–∂–¥—ã–π –∫–ª–æ–Ω = —Ç–æ–ª—å–∫–æ +24 –±–∞–π—Ç–∞ (3√ó8)**

### –†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (1 –∑–∞–¥–∞—á–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å)**
- ‚ùå **–≠—Ñ—Ñ–µ–∫—Ç: 0%** - –∑–∞–¥–∞—á–∏ –Ω–µ –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è
- ‚ùå **–í—ã–≤–æ–¥: –ù–ï –ù–£–ñ–ù–û**

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á (–µ—Å–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: ~85% —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏** –Ω–∞ –∫–∞–∂–¥—ã–π –∫–ª–æ–Ω
- ‚úÖ **–ü—Ä–∏–º–µ—Ä**: –ï—Å–ª–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É 10 —Ä–∞–∑:
  - –ë–µ–∑ Arc: 10 √ó 140 –±–∞–π—Ç = **1400 –±–∞–π—Ç**
  - –° Arc: 140 + (9 √ó 24) = **356 –±–∞–π—Ç** = **—ç–∫–æ–Ω–æ–º–∏—è 1044 –±–∞–π—Ç–∞ (75%)**

### –í—ã–≤–æ–¥:

‚ùå **–ù–ï –î–ï–õ–ê–¢–¨** - –∑–∞–¥–∞—á–∏ –Ω–µ –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ. –≠—Ñ—Ñ–µ–∫—Ç –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–∞—Ö, –≥–¥–µ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ü–û–õ–ï–ó–ù–û:**
- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º async –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ï—Å–ª–∏ –æ–¥–∏–Ω URL –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞

---

## 2. –ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

```rust
// –í main.rs:216-220
if let Err(e) = create_user(&conn, chat_id, username) {
    log::error!("Failed to create user: {}", e);
} else if let Err(e) = log_request(&conn, chat_id, text) {
    log::error!("Failed to log request for new user: {}", e);
}
```

**–î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞:**
1. `INSERT INTO users ...` (~0.5-1ms)
2. `INSERT INTO requests ...` (~0.5-1ms)
**–ò—Ç–æ–≥–æ: ~1-2ms**

### –ß—Ç–æ –¥–∞—Å—Ç –±–∞—Ç—á–∏–Ω–≥:

```rust
let tx = conn.transaction()?;
create_user_in_tx(&tx, chat_id, username)?;
log_request_in_tx(&tx, chat_id, text)?;
tx.commit()?;
```

**–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π:**
- BEGIN TRANSACTION (~0.1ms)
- INSERT 1 (~0.5ms)
- INSERT 2 (~0.5ms)
- COMMIT (~0.1ms)
**–ò—Ç–æ–≥–æ: ~1.2ms**

### –†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (create_user + log_request)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: ~20-30% —É—Å–∫–æ—Ä–µ–Ω–∏–µ** (—Å 2ms –¥–æ 1.2ms)
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è: ~0.8ms –Ω–∞ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç–æ–ª—å–∫–æ log_request)**
- ‚ùå **–≠—Ñ—Ñ–µ–∫—Ç: 0%** - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å, –±–∞—Ç—á–∏–Ω–≥ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (100 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–µ–∫)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: —ç–∫–æ–Ω–æ–º–∏—è ~80ms/—Å–µ–∫** (100 √ó 0.8ms)
- ‚úÖ **–≠—Ç–æ ~8% CPU –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ SQLite –æ–ø–µ—Ä–∞—Ü–∏–∏**

### –í—ã–≤–æ–¥:

‚ö†Ô∏è **–ú–û–ñ–ù–û –°–î–ï–õ–ê–¢–¨, –ù–û –ù–ï –ö–†–ò–¢–ò–ß–ù–û**

**–†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- ~0.8ms —ç–∫–æ–Ω–æ–º–∏–∏ –Ω–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏ 100 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö/—Å–µ–∫ = —ç–∫–æ–Ω–æ–º–∏—è ~80ms/—Å–µ–∫
- –≠—Ç–æ **–º–∞–ª–æ–∑–∞–º–µ—Ç–Ω–æ** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–¥–µ—Ä–∂–∫–∞ —É–∂–µ ~50-100ms –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è)

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ü–û–õ–ï–ó–ù–û:**
- –ï—Å–ª–∏ —É –≤–∞—Å –º–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ create_user —É—Å–ø–µ—à–µ–Ω, –Ω–æ log_request –ø–∞–¥–∞–µ—Ç - –æ—Ç–∫–∞—Ç)
- –ï—Å–ª–∏ SQLite —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º

**–ö–æ–≥–¥–∞ –ù–ï –ù–£–ñ–ù–û:**
- –ï—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- –ï—Å–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∑–∫–∞—è (<10 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–µ–∫)
- –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

```rust
// downloader.rs:42
async fn get_metadata_from_ytdlp(url: &Url) -> Result<(String, String), AppError> {
    // –í—ã–∑—ã–≤–∞–µ—Ç yt-dlp --get-title
    // –í—Ä–µ–º—è: ~500-2000ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–∏ –∏ YouTube API)
}
```

**–ö–∞–∂–¥—ã–π —Ä–∞–∑:**
- –í—ã–∑–æ–≤ `yt-dlp --get-title` —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ—Å—Å
- –ü–∞—Ä—Å–∏–Ω–≥ stdout
- **–í—Ä–µ–º—è: 500-2000ms**

### –ß—Ç–æ –¥–∞—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

```rust
static METADATA_CACHE: Lazy<Mutex<LruCache<String, (String, String)>>> = 
    Lazy::new(|| Mutex::new(LruCache::new(100)));

// –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Ç–æ–≥–æ –∂–µ URL:
// –í—Ä–µ–º—è: ~0.001ms (—á—Ç–µ–Ω–∏–µ –∏–∑ HashMap)
```

### –†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ URL (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π)**
- ‚ùå **–≠—Ñ—Ñ–µ–∫—Ç: 0%** - –∫—ç—à –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚ùå **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**: ~1-2ms –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –∫—ç—à–∞ + –ø–∞–º—è—Ç—å

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ—Ö –∂–µ URL (5% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: —ç–∫–æ–Ω–æ–º–∏—è 500-2000ms –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å**
- ‚úÖ **–ü—Ä–∏ 100 –∑–∞–ø—Ä–æ—Å–∞—Ö/—á–∞—Å —Å 5% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π = 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞**
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è: 5 √ó 1500ms = 7.5 —Å–µ–∫—É–Ω–¥/—á–∞—Å = —ç–∫–æ–Ω–æ–º–∏—è ~0.2% –≤—Ä–µ–º–µ–Ω–∏**

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—ã—Å–æ–∫–∞—è –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å (20% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π, –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: —ç–∫–æ–Ω–æ–º–∏—è 20 √ó 1500ms = 30 —Å–µ–∫—É–Ω–¥/—á–∞—Å**
- ‚úÖ **–≠—Ç–æ ~0.8% —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ CPU**

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏ (50% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)**
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç: —ç–∫–æ–Ω–æ–º–∏—è 50 √ó 1500ms = 75 —Å–µ–∫—É–Ω–¥/—á–∞—Å**
- ‚úÖ **–≠—Ç–æ ~2% —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ CPU**

### –ü—Ä–æ–±–ª–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –Ω–∞ YouTube
   - Thumbnail –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
   - **–ù—É–∂–µ–Ω TTL (time-to-live): ~1 —á–∞—Å**

2. **–ü–∞–º—è—Ç—å:**
   - 100 URL √ó ~200 –±–∞–π—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö = ~20 KB
   - **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –Ω—É–ª–µ–≤—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã**

3. **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è:**
   - Mutex –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
   - –ù—É–∂–µ–Ω async Mutex –∏–ª–∏ lock-free —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –í—ã–≤–æ–¥:

‚ö†Ô∏è **–ú–û–ñ–ù–û –°–î–ï–õ–ê–¢–¨, –ï–°–õ–ò –ï–°–¢–¨ –ü–û–í–¢–û–†–Ø–ï–ú–û–°–¢–¨**

**–†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ –Ω–∏–∑–∫–æ–π –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏ (<5%): **—ç—Ñ—Ñ–µ–∫—Ç –º–∏–Ω–∏–º–∞–ª–µ–Ω (~0.2%)**
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏ (>20%): **—ç—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ—Ç–µ–Ω (~2%)**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ü–û–õ–ï–ó–ù–û:**
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏
- –ï—Å–ª–∏ –µ—Å—Ç—å "—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ" –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–∞—á–∏–≤–∞—é—Ç –º–Ω–æ–≥–æ —Ä–∞–∑
- –ï—Å–ª–∏ `yt-dlp` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º (–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å)

**–ö–æ–≥–¥–∞ –ù–ï –ù–£–ñ–ù–û:**
- –ï—Å–ª–∏ –∫–∞–∂–¥—ã–π URL —É–Ω–∏–∫–∞–ª–µ–Ω (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ)
- –ï—Å–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∑–∫–∞—è (<10 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å)
- –ï—Å–ª–∏ `yt-dlp` –±—ã—Å—Ç—Ä—ã–π (<500ms)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–Ω–æ –ª–∏:**
```rust
// –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏ URL
let url_str = url.as_str();
if cache.contains(url_str) {
    cache_hits += 1;
} else {
    cache_misses += 1;
}
// –ï—Å–ª–∏ cache_hits / (cache_hits + cache_misses) > 0.1 (10%), —Ç–æ —Å—Ç–æ–∏—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ | –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|------------|---------------------------|----------------------------|-----------|--------------|
| **Arc<str> –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö** | 0% (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | 0% (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | –í—ã—Å–æ–∫–∞—è | ‚ùå **–ù–ï –î–ï–õ–ê–¢–¨** |
| **–ë–∞—Ç—á–∏–Ω–≥ –ë–î** | ~0.8ms/–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | ~80ms/—Å–µ–∫ –ø—Ä–∏ 100 –Ω–æ–≤—ã—Ö/—Å–µ–∫ | –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** |
| **–ö—ç—à –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** | ~0.2% (5% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π) | ~2% (20% –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π) | –ù–∏–∑–∫–∞—è | ‚ö†Ô∏è **–ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è** |

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚ùå –ù–ï –î–ï–õ–ê–¢–¨:
1. **Arc<str> –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö** - –∑–∞–¥–∞—á–∏ –Ω–µ –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è, —ç—Ñ—Ñ–µ–∫—Ç = 0

### ‚ö†Ô∏è –ú–û–ñ–ù–û –°–î–ï–õ–ê–¢–¨ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–µ–º—è):
1. **–ë–∞—Ç—á–∏–Ω–≥ –ë–î** - –Ω–µ–±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç (~20-30% –Ω–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π), –Ω–æ —É–ª—É—á—à–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
2. **–ö—ç—à –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É –∏ –ø–æ—Ç–æ–º —Ä–µ—à–∏—Ç—å

### üí° –õ—É—á—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

1. **–°–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä–∏—Ç—å:**
   - –°–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–µ–∫?
   - –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è URL?
   - –ì–¥–µ —Ä–µ–∞–ª—å–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞?

2. **–ó–∞—Ç–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:**
   - –ï—Å–ª–∏ SQLite —É–∑–∫–æ–µ –º–µ—Å—Ç–æ ‚Üí –±–∞—Ç—á–∏–Ω–≥
   - –ï—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π URL ‚Üí –∫—ç—à
   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è ‚Üí Arc<str>

3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –í—ã—Å–æ–∫–∏–π: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ, —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ
   - –°—Ä–µ–¥–Ω–∏–π: –ë–∞—Ç—á–∏–Ω–≥ –ë–î (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
   - –ù–∏–∑–∫–∏–π: –ö—ç—à –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è)

---

## üìà –ö–æ–≥–¥–∞ —ç—Ç–æ —Å—Ç–∞–Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ:

### Arc<str> –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö:
- ‚úÖ –ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ async –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- ‚úÖ –ï—Å–ª–∏ –æ–¥–∏–Ω URL –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- ‚ùå **–°–µ–π—á–∞—Å: –Ω–µ –Ω—É–∂–Ω–æ**

### –ë–∞—Ç—á–∏–Ω–≥ –ë–î:
- ‚úÖ –ï—Å–ª–∏ >50 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–µ–∫
- ‚úÖ –ï—Å–ª–∏ SQLite —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º (>10% CPU)
- ‚ö†Ô∏è **–°–µ–π—á–∞—Å: –Ω–µ–±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç, –Ω–æ —É–ª—É—á—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**

### –ö—ç—à –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ –ï—Å–ª–∏ >10% –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è URL
- ‚úÖ –ï—Å–ª–∏ `yt-dlp` –º–µ–¥–ª–µ–Ω–Ω—ã–π (>1000ms)
- ‚ö†Ô∏è **–°–µ–π—á–∞—Å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

---

## üîç –ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å:

```rust
// –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:
struct Metrics {
    new_users_per_sec: f64,
    duplicate_urls_ratio: f64,
    ytdlp_avg_time_ms: f64,
    db_operations_per_sec: f64,
}

// –ï—Å–ª–∏:
// - new_users_per_sec > 50 ‚Üí –±–∞—Ç—á–∏–Ω–≥ –ë–î –ø–æ–ª–µ–∑–µ–Ω
// - duplicate_urls_ratio > 0.1 ‚Üí –∫—ç—à –ø–æ–ª–µ–∑–µ–Ω
// - ytdlp_avg_time_ms > 1000 ‚Üí –∫—ç—à –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω
```

**–í—ã–≤–æ–¥: –í—Å–µ —Ç—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–º–µ—é—Ç —Å–º—ã—Å–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. –í —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ –æ–Ω–∏ –¥–∞–¥—É—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.**


