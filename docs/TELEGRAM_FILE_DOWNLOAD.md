# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram

## –û–±–∑–æ—Ä

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram –ø–æ –∏—Ö `file_id`. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç–æ–º, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª—é–±—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram –ø–æ `file_id`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./downloads/`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏–∑ Telegram
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (–¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ)
- ‚úÖ –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞

### `/download_tg <file_id>`

–°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –∏–∑ Telegram –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ.

**–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å**:
```
/download_tg <file_id>
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```
/download_tg BQACAgIAAxkBAAIBCGXxxx...
```

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ**:
```
‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!

üìÅ –ü—É—Ç—å: ./downloads/document.pdf
üìÑ –ò–º—è: document.pdf
üìä –†–∞–∑–º–µ—Ä: 2.45 MB
üÜî File ID: BQACAgIAAxkBAAIBCGXxxx...
```

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ**:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:

[–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏]

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π file_id
‚Ä¢ –§–∞–π–ª –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ Telegram
‚Ä¢ –§–∞–π–ª —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–π (>1 —á–∞—Å–∞ –¥–ª—è –Ω–µ-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
‚Ä¢ –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É
```

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å file_id?

### –°–ø–æ—Å–æ–± 1: –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞

–ï—Å–ª–∏ —Ñ–∞–π–ª –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏:

```sql
SELECT file_id, title FROM download_history
WHERE user_id = 123456789
ORDER BY downloaded_at DESC;
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Telegram Bot API

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –±–æ—Ç—É (–∏–ª–∏ –ø–µ—Ä–µ—Å–ª–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–º)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `getUpdates` –∏–ª–∏ –≤–µ–±—Ö—É–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `file_id`
3. –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: `message.document.file_id`
4. –î–ª—è —Ñ–æ—Ç–æ: `message.photo[last].file_id`
5. –î–ª—è –≤–∏–¥–µ–æ: `message.video.file_id`
6. –î–ª—è –∞—É–¥–∏–æ: `message.audio.file_id`

### –°–ø–æ—Å–æ–± 3: –õ–æ–≥–∏ –±–æ—Ç–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–æ–≤ –±–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç `file_id`:
```
[INFO] Sent audio file: file_id = BQACAgIAAxkBAAIBCGXxxx...
```

## –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏—è `download_file_from_telegram`

–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```rust
pub async fn download_file_from_telegram(
    bot: &Bot,
    file_id: &str,
    destination_path: Option<PathBuf>,
) -> Result<PathBuf>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `bot` - –≠–∫–∑–µ–º–ø–ª—è—Ä Telegram –±–æ—Ç–∞
- `file_id` - Telegram file_id —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- `destination_path` - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –ï—Å–ª–∏ `None`, —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `./downloads/`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**:
- `Ok(PathBuf)` - –ü—É—Ç—å –∫ —Å–∫–∞—á–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
- `Err(anyhow::Error)` - –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ**:
```rust
use doradura::telegram::download_file_from_telegram;
use std::path::PathBuf;

// –°–∫–∞—á–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (./downloads/)
let path = download_file_from_telegram(&bot, "BQACAgIAAxkBAAIBCGXxxx...", None).await?;
println!("–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {:?}", path);

// –°–∫–∞—á–∞—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ
let custom_path = PathBuf::from("./backups/my_file.pdf");
let path = download_file_from_telegram(&bot, "BQACAgIAAxkBAAIBCGXxxx...", Some(custom_path)).await?;
println!("–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {:?}", path);
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram API

### –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

Telegram —Ö—Ä–∞–Ω–∏—Ç —Ñ–∞–π–ª—ã –Ω–∞ —Å–≤–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ä–æ–∫–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞:

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è |
|-----------|---------------|
| –î–æ–∫—É–º–µ–Ω—Ç—ã | –ë–µ—Å—Å—Ä–æ—á–Ω–æ (–ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º) |
| –§–æ—Ç–æ | 1 —á–∞—Å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ |
| –í–∏–¥–µ–æ/–ê—É–¥–∏–æ | 1 —á–∞—Å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ |
| Voice/Video messages | 1 —á–∞—Å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ |

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø "document" –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.

### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤

- Telegram Bot API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–æ **20 –ú–ë**
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Telegram Bot API Server –ª–∏–º–∏—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞ –∑–∞–ø—É—Å–∫–∞. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –±–µ–∑ `--local`, –æ–Ω –æ–±—ã—á–Ω–æ –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ Bot API.

–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Bot API Server (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `BOT_API_URL`), –ø–æ—ç—Ç–æ–º—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã.

## –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:
```
./downloads/
```

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```
./downloads/
‚îú‚îÄ‚îÄ document_123.pdf
‚îú‚îÄ‚îÄ audio_456.mp3
‚îú‚îÄ‚îÄ video_789.mp4
‚îî‚îÄ‚îÄ file_ABC.bin
```

–ò–º—è —Ñ–∞–π–ª–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø—É—Ç–∏ Telegram (`file.path`). –ï—Å–ª–∏ –ø—É—Ç—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `file_id`.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```log
[INFO] üì• Starting download for file_id: BQACAgIAAxkBAAIBCGXxxx...
[INFO] ‚úÖ File info retrieved: path = documents/file_123.pdf, size = 2567890 bytes
[INFO] üìÇ Destination path: "./downloads/file_123.pdf"
[INFO] ‚úÖ File downloaded successfully to: "./downloads/file_123.pdf"
[INFO] üìä File size: 2567890 bytes (2.45 MB)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/download_tg` –¥–æ—Å—Ç—É–ø–Ω–∞ **—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `is_admin(username)`
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ADMIN_USERNAME`

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `file_id` –≤ –∫–æ–º–∞–Ω–¥–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö `file_id`
- ‚úÖ Graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç `file_id` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
   ```sql
   SELECT file_id FROM download_history WHERE user_id = 123456789 AND title LIKE '%–ø–µ—Å–Ω—è%';
   ```
3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª:
   ```
   /download_tg BQACAgIAAxkBAAIBCGXxxx...
   ```
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∞–π–ª –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–≤—Ç–æ—Ä–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë—ç–∫–∞–ø –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

–°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ç–∫–∞–ø–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏:

```rust
use doradura::telegram::download_file_from_telegram;
use doradura::storage::db;

async fn backup_all_files(bot: &Bot, db_pool: &DbPool) -> Result<()> {
    let conn = db::get_connection(db_pool)?;
    let history = db::get_all_download_history(&conn)?;

    for record in history {
        if let Some(file_id) = record.file_id {
            let backup_path = PathBuf::from(format!("./backups/{}", record.id));
            match download_file_from_telegram(bot, &file_id, Some(backup_path)).await {
                Ok(path) => println!("‚úÖ Backed up: {:?}", path),
                Err(e) => eprintln!("‚ùå Failed to backup {}: {}", file_id, e),
            }
        }
    }

    Ok(())
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏

1. –ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ `file_id`:
   ```sql
   SELECT file_id FROM download_history WHERE file_id IS NOT NULL;
   ```
2. –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã:
   ```bash
   while read file_id; do
       echo "/download_tg $file_id" | send-to-bot
   done < file_ids.txt
   ```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ file_id –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ `file_id` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```rust
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
let sent_message = bot.send_document(chat_id, document).await?;
let file_id = sent_message.document().map(|d| d.file.id.clone());

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
save_download_history(
    &conn,
    user_id,
    url,
    title,
    format,
    file_id.as_deref(), // –ü–µ—Ä–µ–¥–∞–µ–º file_id
)?;
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: "Failed to download file"

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –§–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ Telegram (–ø—Ä–æ—à–ª–æ >1 —á–∞—Å –¥–ª—è —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
2. –ù–µ–≤–µ—Ä–Ω—ã–π `file_id`
3. –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `file_id` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Telegram
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞: "Permission denied"

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./downloads/`
2. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –∑–∞–ø–∏—Å–∏

**–†–µ—à–µ–Ω–∏–µ**:
```bash
mkdir -p ./downloads
chmod 755 ./downloads
```

### –û—à–∏–±–∫–∞: "File too large"

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –§–∞–π–ª –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç Bot API (20 –ú–ë)
2. –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π Bot API Server

**–†–µ—à–µ–Ω–∏–µ**:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π Telegram Bot API Server
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `BOT_API_URL` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ–ª–µ–µ –≥–æ–¥–∞ –Ω–∞–∑–∞–¥?**
A: –î–∞, –µ—Å–ª–∏ —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç (`document`). Telegram —Ö—Ä–∞–Ω–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–µ—Å—Å—Ä–æ—á–Ω–æ. –§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —á–∞—Å.

**Q: –ë—É–¥–µ—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞?**
A: –î–∞, `file_id` –æ—Å—Ç–∞–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞.

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞?**
A: –ù–µ—Ç, `file_id` –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –±–æ—Ç—É. –§–∞–π–ª—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –±–æ—Ç–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

**Q: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö?**
A: –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite –≤ —Ç–∞–±–ª–∏—Ü–µ `download_history` (–∫–æ–ª–æ–Ω–∫–∞ `file_id`).

## –°–º. —Ç–∞–∫–∂–µ

- [Telegram Bot API - File](https://core.telegram.org/bots/api#file)
- [Telegram Bot API - getFile](https://core.telegram.org/bots/api#getfile)
- [–õ–æ–∫–∞–ª—å–Ω—ã–π Bot API Server](https://github.com/tdlib/telegram-bot-api)
