# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏, –æ—Å—Ç–∞–≤–∞—è—Å—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–∏ "‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."

## –ü—Ä–∏—á–∏–Ω–∞
–£—Å–ª–æ–≤–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º:
```rust
// ‚ùå –ë–´–õ–û - –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–µ, –∫—Ä–∞—Ç–Ω–æ–º 5 (0%, 5%, 10%, 15%...)
if progress_info.percent % 5 == 0 && progress_info.percent != last_progress {
    // –æ–±–Ω–æ–≤–∏—Ç—å UI
}
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ –µ—Å–ª–∏ yt-dlp –≤—ã–≤–æ–¥–∏–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, 3%, 8%, 13%, 27%, —ç—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ –∫—Ä–∞—Ç–Ω—ã 5.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (`src/downloader.rs`)

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
```rust
// ‚úÖ –°–¢–ê–õ–û - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–Ω–∏—Ü–µ >= 5% –∏–ª–∏ –ø–µ—Ä–≤–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
let progress_diff = if progress_info.percent >= last_progress {
    progress_info.percent - last_progress
} else {
    progress_info.percent
};

if progress_diff >= 5 || last_progress == 0 {
    last_progress = progress_info.percent;
    log::info!("Updating progress UI: {}%", progress_info.percent);
    // –æ–±–Ω–æ–≤–∏—Ç—å UI
}
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –í–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ `percent % 5 == 0` (–∫—Ä–∞—Ç–Ω–æ 5) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ **—Ä–∞–∑–Ω–∏—Ü–∞ >= 5%**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `last_progress == 0` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã:**

| –ü—Ä–æ–≥—Ä–µ—Å—Å yt-dlp | –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ | –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ |
|-----------------|---------------|--------------|
| 0% ‚Üí 3% | ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–ø–µ—Ä–≤–æ–µ) |
| 3% ‚Üí 8% | ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (diff=5) |
| 8% ‚Üí 13% | ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (diff=5) |
| 13% ‚Üí 15% | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (diff=2) |
| 15% ‚Üí 22% | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (diff=7) |

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `parse_progress`:

```rust
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
log::debug!("Progress parsed successfully: {}% (speed: {:?} MB/s, eta: {:?}s)", 
           p, speed_mbs, eta_seconds);

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
log::debug!("Could not parse percent from line: {}", line);

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
log::info!("Updating progress UI: {}%", progress_info.percent);
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ yt-dlp.

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –¥–ª—è:
- ‚úÖ –ê—É–¥–∏–æ –∑–∞–≥—Ä—É–∑–∫–∏ (`download_and_send_audio`)
- ‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∑–∫–∏ (`download_and_send_video`)

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
# –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å "Progress parsed successfully"
grep "Progress parsed" /path/to/logs

# –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å "Updating progress UI"
grep "Updating progress UI" /path/to/logs
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ yt-dlp:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
chmod +x test_progress.sh
./test_progress.sh
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞:
```
[download]   3.2% of 10.50MiB at 2.30MiB/s ETA 00:04
[download]   8.7% of 10.50MiB at 2.45MiB/s ETA 00:03
```

3. **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:**
   - yt-dlp –Ω–µ –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é)
   - –§–∞–π–ª —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ (< 5 —Å–µ–∫—É–Ω–¥)
   - –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ yt-dlp –∏–∑–º–µ–Ω–∏–ª—Å—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é)
   - –ü—Ä–æ–±–ª–µ–º—ã —Å Android client (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ–∑ `--extractor-args`)

4. **–í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
export RUST_LOG=doradura=debug
./doradura
```

### –§–æ—Ä–º–∞—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ yt-dlp

–§—É–Ω–∫—Ü–∏—è `parse_progress` –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞:
```
[download]  <–ø—Ä–æ—Ü–µ–Ω—Ç>% of <—Ä–∞–∑–º–µ—Ä> at <—Å–∫–æ—Ä–æ—Å—Ç—å> ETA <–≤—Ä–µ–º—è>
```

–ü—Ä–∏–º–µ—Ä—ã:
```
[download]  45.2% of 10.00MiB at 500.00KiB/s ETA 00:10
[download]  78.5% of 25.30MiB at 2.3MiB/s ETA 00:02
[download] 100% of 8.50MiB at 1.5MiB/s ETA 00:00
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä:
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–Ω–æ–º 5)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ ETA
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ ~5% –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò–º–µ–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üéµ Video Title

‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ...
[–∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –∑–¥–µ—Å—å –¥–æ –∫–æ–Ω—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏]
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üéµ Video Title

üì• –°–∫–∞—á–∏–≤–∞—é: 3%
[‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]

‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: 2.3 MB/s
‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ~12 —Å–µ–∫
üì¶ –†–∞–∑–º–µ—Ä: 0.3 / 10.5 MB
```

```
üéµ Video Title

üì• –°–∫–∞—á–∏–≤–∞—é: 47%
[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë]

‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: 2.5 MB/s
‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ~5 —Å–µ–∫
üì¶ –†–∞–∑–º–µ—Ä: 4.9 / 10.5 MB
```

```
üéµ Video Title

‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ 8 —Å–µ–∫—É–Ω–¥!
```

