# –ü–æ—Ç–æ–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞ Doradura

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ—Ç–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã Telegram-–±–æ—Ç–∞ Doradura –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ —Å YouTube –∏ SoundCloud.

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–ë–æ—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

- **`main.rs`** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
- **`commands.rs`** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`menu.rs`** - —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–ª–∞–π–Ω-–º–µ–Ω—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- **`downloader.rs`** - –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ –∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
- **`queue.rs`** - —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- **`rate_limiter.rs`** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`db.rs`** - —Ä–∞–±–æ—Ç–∞ —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
- **`progress.rs`** - —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- **`config.rs`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **`fetch.rs`** - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (legacy, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è yt-dlp –Ω–∞–ø—Ä—è–º—É—é)
- **`utils.rs`** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram API ‚Üí Dispatcher ‚Üí Handler ‚Üí Commands/Menu
                                                          ‚Üì
                                                      Rate Limiter
                                                          ‚Üì
                                                      Download Queue
                                                          ‚Üì
                                                   Queue Processor
                                                          ‚Üì
                                                   Downloader (yt-dlp)
                                                          ‚Üì
                                                   Telegram API (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞)
```

---

## 2. –°–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ dispatcher
2. **–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π** - –±–æ—Ç —Å–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ `/start`, `/mode`
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–∞—Ä—Å–∏–Ω–≥ URL, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. **–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–ª–∞–π–Ω-–º–µ–Ω—é
7. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –∑–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏
8. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞** - –ø—Ä–æ—Ü–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ yt-dlp
9. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ Telegram
10. **–û—à–∏–±–∫–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–∞—Ö

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (DownloadStatus)

- **Starting** - –Ω–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- **Downloading** - –ø—Ä–æ—Ü–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (0-100%)
- **Uploading** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –≤ Telegram
- **Success** - —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- **Completed** - —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ)
- **Error** - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

---

## 3. –ü–æ—Ç–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3.1. –ü–æ—Ç–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

**–®–∞–≥–∏:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `app.log`
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞ (—É—Ä–æ–≤–µ–Ω—å Debug)

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –ß—Ç–µ–Ω–∏–µ `.env` —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `TELOXIDE_TOKEN`

3. **–°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bot —Å HTTP –∫–ª–∏–µ–Ω—Ç–æ–º
   - –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥:
     - `/start` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
     - `/mode` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏

5. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–¥–æ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `database.sqlite`
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∏–∑ `migration.sql`
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: `users`, `request_history`

6. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   - Rate Limiter (–∏–Ω—Ç–µ—Ä–≤–∞–ª: 30 —Å–µ–∫—É–Ω–¥)
   - Download Queue (–ø—É—Å—Ç–∞—è –æ—á–µ—Ä–µ–¥—å)
   - –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏

7. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Dispatcher**
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥ (`Command::Start`, `Command::Mode`)
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–∞—Ä—Å–∏–Ω–≥ URL)
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (–º–µ–Ω—é)

8. **–ó–∞–ø—É—Å–∫ dispatcher —Å retry –ª–æ–≥–∏–∫–æ–π**
   - –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
   - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É retry: 5 —Å–µ–∫—É–Ω–¥

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:** –ù–µ—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–≥-—Ñ–∞–π–ª–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π
- –û—à–∏–±–∫–∞ dispatcher ‚Üí retry –¥–æ 5 —Ä–∞–∑, –∑–∞—Ç–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

---

### 3.2. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /start

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–∫–∞–∑ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞.

**–®–∞–≥–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
   - Dispatcher –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞**
   - –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (14 —Å—Ç–∏–∫–µ—Ä–æ–≤ –∏–∑ –ø–∞–∫–∞ `doraduradoradura`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ timestamp –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –¢–µ–∫—Å—Ç: `"–•—ç–π! –Ø –î–æ—Ä–∞, –¥–∞–π –º–Ω–µ —Å—Å—ã–ª–∫—É –∏ —è —Å–∫–∞—á–∞—é ‚ù§Ô∏è‚Äçüî•"`
   - –§–æ—Ä–º–∞—Ç: MarkdownV2

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –°—Ç–∏–∫–µ—Ä (—Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ –ø–∞–∫–∞)
- `"–•—ç–π! –Ø –î–æ—Ä–∞, –¥–∞–π –º–Ω–µ —Å—Å—ã–ª–∫—É –∏ —è —Å–∫–∞—á–∞—é ‚ù§Ô∏è‚Äçüî•"`

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä–∞ ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π"

---

### 3.3. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /mode

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏.

**–®–∞–≥–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/mode`
   - Dispatcher –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ó–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`download_format`)
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Ñ–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"mp3"`

3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏**
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ —Ñ–æ—Ä–º–∞—Ç–∞:
     - `"mp3"` ‚Üí `"üéµ MP3"`
     - `"mp4"` ‚Üí `"üé¨ MP4"`
     - `"srt"` ‚Üí `"üìù SRT"`
     - `"txt"` ‚Üí `"üìÑ TXT"`
   - –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: `"üì• –¢–∏–ø –∑–∞–≥—Ä—É–∑–∫–∏: [—ç–º–æ–¥–∑–∏] [—Ñ–æ—Ä–º–∞—Ç]"`

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**
   - –ö–Ω–æ–ø–∫–∞ 1: `"üì• –¢–∏–ø –∑–∞–≥—Ä—É–∑–∫–∏: [—Ñ–æ—Ä–º–∞—Ç]"` ‚Üí callback `"mode:download_type"`
   - –ö–Ω–æ–ø–∫–∞ 2: `"üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã"` ‚Üí callback `"mode:services"`

5. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –º–µ–Ω—é**
   - –¢–µ–∫—Å—Ç: `"üéµ *–î–æ—Ä–∞ - –†–µ–∂–∏–º—ã –ó–∞–≥—Ä—É–∑–∫–∏*\n\n–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å!"`
   - –§–æ—Ä–º–∞—Ç: MarkdownV2
   - –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- `"üéµ *–î–æ—Ä–∞ - –†–µ–∂–∏–º—ã –ó–∞–≥—Ä—É–∑–∫–∏*\n\n–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å!"`

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–Ω—é ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback (—Ä–∞–∑–¥–µ–ª 3.5)

---

### 3.4. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å URL

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

**–®–∞–≥–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - Dispatcher –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã**
   - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/start` –∏–ª–∏ `/help` ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—Ç

3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ URL –∏–∑ —Ç–µ–∫—Å—Ç–∞**
   - –ü–æ–∏—Å–∫ URL –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é: `r"https?://[^\s]+"`
   - –ï—Å–ª–∏ URL –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 12 (—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã URL**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 2048 —Å–∏–º–≤–æ–ª–æ–≤
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 11 (–æ—à–∏–±–∫–∞ –¥–ª–∏–Ω—ã)

5. **–ü–∞—Ä—Å–∏–Ω–≥ URL**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `url::Url::parse()`
   - –ï—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π URL ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 11 (–æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)

6. **–û—á–∏—Å—Ç–∫–∞ URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `list`**
   - –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `&list=` –∏–∑ query string YouTube
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤

7. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
   - –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `telegram_id`
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Ñ–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"mp3"`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

8. **–ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: 30 —Å–µ–∫—É–Ω–¥
   - –ï—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 13 (—Å–æ–æ–±—â–µ–Ω–∏–µ –æ rate limit)

9. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∑–∫–∏**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –∑–∞–¥–∞—á–∏
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ (`is_video = format == "mp4"`)
   - –°–æ–∑–¥–∞–Ω–∏–µ `DownloadTask` —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º

10. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å**
    - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ `DownloadQueue`
    - –ó–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ–æ–Ω–æ–≤—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º

11. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è**
    - –¢–µ–∫—Å—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞:
      - `"mp3"` ‚Üí `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫! üéµ –¢–µ—Ä–ø–µ–Ω–∏–µ!"`
      - `"mp4"` ‚Üí `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ –≤–∏–¥–µ–æ! üé• –¢–µ—Ä–ø–µ–Ω–∏–µ!"`
      - `"srt"` ‚Üí `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Å—É–±—Ç–∏—Ç—Ä—ã! üìù –¢–µ—Ä–ø–µ–Ω–∏–µ!"`
      - `"txt"` ‚Üí `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Å—É–±—Ç–∏—Ç—Ä—ã! üìÑ –¢–µ—Ä–ø–µ–Ω–∏–µ!"`
      - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ñ–∞–π–ª! ‚ù§Ô∏è‚Äçüî• –¢–µ—Ä–ø–µ–Ω–∏–µ!"`

12. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ë–î**
    - –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `request_history`
    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `user_id` –∏ `request_text` (URL)

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –æ–¥–Ω–æ –∏–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—à–∞–≥ 11)
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ URL: `"–ò–∑–≤–∏–Ω–∏, —è –Ω–µ –Ω–∞—à–ª–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube –∏–ª–∏ SoundCloud. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏ –º–Ω–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç—Ä–µ–∫ –∏–ª–∏ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Ö–æ—á–µ—à—å —Å–∫–∞—á–∞—Ç—å."`
- –ü—Ä–∏ –¥–ª–∏–Ω–Ω–æ–º URL: `"–ò–∑–≤–∏–Ω–∏, —Å—Å—ã–ª–∫–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è (–º–∞–∫—Å–∏–º—É–º 2048 —Å–∏–º–≤–æ–ª–æ–≤). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É."`
- –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º URL: `"–ò–∑–≤–∏–Ω–∏, —è –Ω–µ —Å–º–æ–≥–ª–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—Å—ã–ª–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏ –º–Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –∏–ª–∏ SoundCloud."`
- –ü—Ä–∏ rate limit: `"–Ø –î–æ—Ä–∞, —á–∞–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ —è –Ω–µ —Å–º–æ–≥—É —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ —Å–µ–π—á–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ [X] [—Å–µ–∫—É–Ω–¥/—Å–µ–∫—É–Ω–¥—ã/—Å–µ–∫—É–Ω–¥]."` –∏–ª–∏ `"–Ø –î–æ—Ä–∞, —á–∞–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ —è –Ω–µ —Å–º–æ–≥—É —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ —Å–µ–π—á–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–æ–∑–∂–µ."`

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏"
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–û—à–∏–±–∫–∞"

---

### 3.5. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (–º–µ–Ω—é)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –∏–Ω–ª–∞–π–Ω-–º–µ–Ω—é.

**–®–∞–≥–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ callback-–∑–∞–ø—Ä–æ—Å–∞**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é
   - Dispatcher –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤

2. **–û—Ç–≤–µ—Ç –Ω–∞ callback**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ `answer_callback_query` –¥–ª—è —É–±–∏—Ä–∞–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏

3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö callback**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `callback_data` –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `chat_id` –∏ `message_id` –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ callback**

#### 4a. Callback `mode:download_type`

- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞**
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
  - –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞:
    - `"üéµ MP3 ‚úì"` –∏–ª–∏ `"üéµ MP3"` ‚Üí callback `"format:mp3"`
    - `"üé¨ MP4 ‚úì"` –∏–ª–∏ `"üé¨ MP4"` ‚Üí callback `"format:mp4"`
    - `"üìù SRT ‚úì"` –∏–ª–∏ `"üìù SRT"` ‚Üí callback `"format:srt"`
    - `"üìÑ TXT ‚úì"` –∏–ª–∏ `"üìÑ TXT"` ‚Üí callback `"format:txt"`
  - –ö–Ω–æ–ø–∫–∞ `"üîô –ù–∞–∑–∞–¥"` ‚Üí callback `"back:main"`
  - –¢–µ–∫—Å—Ç: `"–í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:\n\n*–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç: [—Ñ–æ—Ä–º–∞—Ç]*"`
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 4b. Callback `mode:services`

- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–∏—Å–∞—Ö**
  - –¢–µ–∫—Å—Ç:
    ```
    üåê *–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã*

    üé• *YouTube*
    ‚Ä¢ MP3 (–ê—É–¥–∏–æ)
    ‚Ä¢ MP4 (–í–∏–¥–µ–æ)
    ‚Ä¢ SRT (–°—É–±—Ç–∏—Ç—Ä—ã)
    ‚Ä¢ TXT (–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã)

    üéµ *SoundCloud*
    ‚Ä¢ MP3 (–ê—É–¥–∏–æ)

    –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç—Ä–µ–∫ –∏–ª–∏ –≤–∏–¥–µ–æ! ‚ù§Ô∏è‚Äçüî•
    ```
  - –ö–Ω–æ–ø–∫–∞ `"üîô –ù–∞–∑–∞–¥"` ‚Üí callback `"back:main"`
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 4c. Callback `back:main`

- **–í–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é**
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é (–∫–∞–∫ –≤ –∫–æ–º–∞–Ω–¥–µ `/mode`)
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 4d. Callback `format:[—Ñ–æ—Ä–º–∞—Ç]`

- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏**
  - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–∑ callback (`mp3`, `mp4`, `srt`, `txt`)
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `download_format` –≤ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (–ø–æ–∫–∞–∑ –Ω–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å ‚úì)

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞: `"–í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:\n\n*–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç: [—Ñ–æ—Ä–º–∞—Ç]*"`
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–∞—Ö: —Å–º. –≤—ã—à–µ (4b)
- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é: `"üéµ *–î–æ—Ä–∞ - –†–µ–∂–∏–º—ã –ó–∞–≥—Ä—É–∑–∫–∏*\n\n–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å!"`

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫" –∏–ª–∏ "–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π"

---

### 3.6. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–≥—Ä—É–∑–æ–∫

**–û–ø–∏—Å–∞–Ω–∏–µ:** –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É.

**–®–∞–≥–∏:**

1. **–ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**
   - –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –≤ —Ü–∏–∫–ª–µ

2. **–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏: 100 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tokio::time::interval`

3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏**
   - –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ `queue.get_task()`
   - –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∫ —à–∞–≥—É 2

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–º–∞—Ñ–æ—Ä–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫**
   - –ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 5
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tokio::sync::Semaphore`
   - –û–∂–∏–¥–∞–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Å–ª–æ—Ç–∞

5. **–ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π async –∑–∞–¥–∞—á–µ**
   - –ü–∞—Ä—Å–∏–Ω–≥ URL –∏–∑ –∑–∞–¥–∞—á–∏
   - –í—ã–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É:
     - `"mp4"` ‚Üí `download_and_send_video()`
     - `"srt"` –∏–ª–∏ `"txt"` ‚Üí `download_and_send_subtitles()`
     - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí `download_and_send_audio()`

6. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–µ–º–∞—Ñ–æ—Ä–∞**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:** –ù–µ—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ URL ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –∑–∞–¥–∞—á–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ—Ç–æ–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ (—Ä–∞–∑–¥–µ–ª 3.7-3.9)

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ (—Ä–∞–∑–¥–µ–ª 3.7, 3.8 –∏–ª–∏ 3.9)

---

### 3.7. –ü–æ—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (MP3)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ —Å YouTube –∏–ª–∏ SoundCloud.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ProgressMessage` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –í—ã–∑–æ–≤ `get_metadata_from_ytdlp()` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 120 —Å–µ–∫—É–Ω–¥
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (`title`) –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (`artist`)
   - –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 14 (–æ—à–∏–±–∫–∞)

3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è**
   - –ï—Å–ª–∏ `artist` –ø—É—Å—Ç–æ–π ‚Üí —Ç–æ–ª—å–∫–æ `title`
   - –ò–Ω–∞—á–µ ‚Üí `"artist - title"`

4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Starting"**
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**
   - –§–æ—Ä–º–∞—Ç: `"[artist] - [title].mp3"` –∏–ª–∏ `"[title].mp3"`
   - –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

6. **–ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –í—ã–∑–æ–≤ `download_audio_file_with_progress()`
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –ó–∞–ø—É—Å–∫ yt-dlp –≤ blocking task —Å –≤—ã–≤–æ–¥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏**
   - –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏–∑ –≤—ã–≤–æ–¥–∞ yt-dlp
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10% (0%, 10%, 20%, ..., 100%)
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì• –°–∫–∞—á–∏–≤–∞—é: [X]%\n[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë]"`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tokio::select!` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

8. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ffprobe` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Üí –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å = 0

9. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 49 MB
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 14 (–æ—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—Ä–∞)

10. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ —Å retry –ª–æ–≥–∏–∫–æ–π**
    - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 3
    - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 10 —Å–µ–∫—É–Ω–¥
    - –ü–æ–∫–∞–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ "Uploading" –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏:
      - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞[—Ç–æ—á–∫–∏]"`
      - –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–µ–∫ –∫–∞–∂–¥—ã–µ 500 –º—Å
    - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `bot.send_audio()` —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

11. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Success"**
    - –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ [X] [—Å–µ–∫—É–Ω–¥/—Å–µ–∫—É–Ω–¥—ã/—Å–µ–∫—É–Ω–¥]!"`
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

12. **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
    - –ß–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
    - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*"`

13. **–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**
    - –ó–∞–¥–µ—Ä–∂–∫–∞ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ `~/downloads/`

14. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
    - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏
    - –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: `"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å üò¢ –Ø –Ω–∞–ø–∏—Å–∞–ª–∞ –°—Ç—ç–Ω—É"`
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Error":
      - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚ùå –û—à–∏–±–∫–∞: [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏]"`

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- Starting: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."`
- Downloading: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì• –°–∫–∞—á–∏–≤–∞—é: [X]%\n[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë]"`
- Uploading: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞[—Ç–æ—á–∫–∏]"`
- Success: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ [X] [—Å–µ–∫—É–Ω–¥]!"`
- Completed: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*"`
- Error: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚ùå –û—à–∏–±–∫–∞: [–æ–ø–∏—Å–∞–Ω–∏–µ]"`

**–û—à–∏–±–∫–∏:**
- –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error
- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error
- –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–∞
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "Success", –∑–∞—Ç–µ–º "Completed"
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "Error"

---

### 3.8. –ü–æ—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ (MP4)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞ —Å YouTube.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ProgressMessage`
   - –ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –í—ã–∑–æ–≤ `get_metadata_from_ytdlp()` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 120 —Å–µ–∫—É–Ω–¥
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
   - –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 12 (–æ—à–∏–±–∫–∞)

3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è**
   - –ï—Å–ª–∏ `artist` –ø—É—Å—Ç–æ–π ‚Üí —Ç–æ–ª—å–∫–æ `title`
   - –ò–Ω–∞—á–µ ‚Üí `"artist - title"`

4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Starting"**
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**
   - –§–æ—Ä–º–∞—Ç: `"[artist] - [title].mp4"` –∏–ª–∏ `"[title].mp4"`
   - –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

6. **–ü–æ–∫–∞–∑ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ 10%
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì• –°–∫–∞—á–∏–≤–∞—é: 10%\n[‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]"`

7. **–ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ**
   - –ó–∞–ø—É—Å–∫ yt-dlp —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
     - `--format best` (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
     - `--concurrent-fragments 5` (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
   - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

8. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ 90%
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\nüì• –°–∫–∞—á–∏–≤–∞—é: 90%\n[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë]"`

9. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 49 MB
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 12 (–æ—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—Ä–∞)

10. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤–∏–¥–µ–æ —Å retry –ª–æ–≥–∏–∫–æ–π**
    - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 3
    - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 10 —Å–µ–∫—É–Ω–¥
    - –ü–æ–∫–∞–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ "Uploading" –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `bot.send_video()`

11. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Success"**
    - –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ [X] [—Å–µ–∫—É–Ω–¥]!"`
    - –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥

12. **–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**
    - –ó–∞–¥–µ—Ä–∂–∫–∞ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ `~/downloads/`

13. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
    - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏
    - –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: `"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å üò¢ –Ø –Ω–∞–ø–∏—Å–∞–ª–∞ –°—Ç—ç–Ω—É"`
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Error"

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (—Ä–∞–∑–¥–µ–ª 3.7)

**–û—à–∏–±–∫–∏:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (—Ä–∞–∑–¥–µ–ª 3.7)

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (—Ä–∞–∑–¥–µ–ª 3.7)

---

### 3.9. –ü–æ—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ (SRT/TXT)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ —Å YouTube.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ProgressMessage`
   - –ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –í—ã–∑–æ–≤ `get_metadata_from_ytdlp()` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 120 —Å–µ–∫—É–Ω–¥
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
   - –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 10 (–æ—à–∏–±–∫–∞)

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Starting"**
   - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**
   - –§–æ—Ä–º–∞—Ç: `"[title].srt"` –∏–ª–∏ `"[title].txt"`
   - –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

5. **–ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤**
   - –ó–∞–ø—É—Å–∫ yt-dlp —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
     - `--skip-download` (–Ω–µ —Å–∫–∞—á–∏–≤–∞—Ç—å –≤–∏–¥–µ–æ)
     - `--write-auto-subs` (–∑–∞–ø–∏—Å–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—É–±—Ç–∏—Ç—Ä—ã)
     - `--convert-subs=srt` –∏–ª–∏ `--convert-subs=txt`
   - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

6. **–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–æ –æ–∂–∏–¥–∞–µ–º–æ–º—É –ø—É—Ç–∏
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–æ–∏—Å–∫ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `~/downloads/` –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
   - –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 10 (–æ—à–∏–±–∫–∞)

7. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `bot.send_document()`
   - –û–¥–∏–Ω —Ä–∞–∑ (–±–µ–∑ retry –ª–æ–≥–∏–∫–∏)

8. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Success"**
    - –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    - –¢–µ–∫—Å—Ç: `"üéµ *[–Ω–∞–∑–≤–∞–Ω–∏–µ]*\n\n‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ [X] [—Å–µ–∫—É–Ω–¥]!"`
    - –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥

9. **–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**
    - –ó–∞–¥–µ—Ä–∂–∫–∞ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ `~/downloads/`

10. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
    - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏
    - –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: `"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å üò¢ –Ø –Ω–∞–ø–∏—Å–∞–ª–∞ –°—Ç—ç–Ω—É"`
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "Error"

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (—Ä–∞–∑–¥–µ–ª 3.7)

**–û—à–∏–±–∫–∏:**
- –§–∞–π–ª —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å Error

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ (—Ä–∞–∑–¥–µ–ª 3.7)

---

### 3.10. –ü–æ—Ç–æ–∫ rate limiting

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–®–∞–≥–∏:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: 30 —Å–µ–∫—É–Ω–¥

2. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–Ω—è—Ç–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—Ä–µ–º–µ–Ω–µ–º –æ–∂–∏–¥–∞–Ω–∏—è
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –í–æ–∑–≤—Ä–∞—Ç `false` (–∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω)

3. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–π –º–µ—Ç–∫–∏: `—Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è + 30_—Å–µ–∫—É–Ω–¥`
   - –í–æ–∑–≤—Ä–∞—Ç `true` (–∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω)

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ü—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏: `"–Ø –î–æ—Ä–∞, —á–∞–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ —è –Ω–µ —Å–º–æ–≥—É —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ —Å–µ–π—á–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ [X] [—Å–µ–∫—É–Ω–¥/—Å–µ–∫—É–Ω–¥—ã/—Å–µ–∫—É–Ω–¥]."`
- –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: `"–Ø –î–æ—Ä–∞, —á–∞–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ —è –Ω–µ —Å–º–æ–≥—É —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ —Å–µ–π—á–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–æ–∑–∂–µ."`

**–û—à–∏–±–∫–∏:**
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- –ï—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π" (–∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω)
- –ï—Å–ª–∏ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

---

### 3.11. –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–û–ø–∏—Å–∞–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫.

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**

1. **–û—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
   - –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–≥-—Ñ–∞–π–ª–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
   - –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
   - –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

2. **–û—à–∏–±–∫–∏ dispatcher**
   - –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API
   - Retry –¥–æ 5 —Ä–∞–∑ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - –ü–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

3. **–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π**
   - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π URL ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - URL —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - URL –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –û—à–∏–±–∫–∞ –ë–î ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

4. **–û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏**
   - –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ‚Üí —Å—Ç–∏–∫–µ—Ä –æ—à–∏–±–∫–∏ + —Å—Ç–∞—Ç—É—Å Error
   - –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è yt-dlp ‚Üí —Å—Ç–∏–∫–µ—Ä –æ—à–∏–±–∫–∏ + —Å—Ç–∞—Ç—É—Å Error
   - –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Üí —Å—Ç–∏–∫–µ—Ä –æ—à–∏–±–∫–∏ + —Å—Ç–∞—Ç—É—Å Error —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
   - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ ‚Üí —Å—Ç–∏–∫–µ—Ä –æ—à–∏–±–∫–∏ + —Å—Ç–∞—Ç—É—Å Error –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫

5. **–û—à–∏–±–∫–∏ –º–µ–Ω—é**
   - –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
   - –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏: `"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å üò¢ –Ø –Ω–∞–ø–∏—Å–∞–ª–∞ –°—Ç—ç–Ω—É"`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: `"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ([X] MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: [Y] MB"`
- –ü—Ä–∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏: —Å—Ç–∞—Ç—É—Å Error —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º `error` –∏–ª–∏ `warn`
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `app.log` –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

---

## 4. –î–∏–∞–≥—Ä–∞–º–º—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π

### 4.1. –û–±—â–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–æ—Ç–∞

```
[–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è]
    ‚Üì
[–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚Üì
    ‚îú‚îÄ‚Üí [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚îú‚îÄ‚Üí [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /mode] ‚îÄ‚îÄ‚Üí [–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚îú‚îÄ‚Üí [–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è] ‚îÄ‚îÄ‚Üí [–ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit]
    ‚îÇ                                      ‚Üì
    ‚îÇ                                  [Rate Limited] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚îÇ                                      ‚Üì
    ‚îÇ                                  [Not Limited] ‚îÄ‚îÄ‚Üí [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å]
    ‚îÇ                                                          ‚Üì
    ‚îÇ                                                  [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏]
    ‚îÇ                                                          ‚Üì
    ‚îÇ                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                              ‚Üì                           ‚Üì                           ‚Üì
    ‚îÇ                      [–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ]          [–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ]          [–ó–∞–≥—Ä—É–∑–∫–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤]
    ‚îÇ                              ‚Üì                           ‚Üì                           ‚Üì
    ‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                                                          ‚Üì
    ‚îÇ                                                  [–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞]
    ‚îÇ                                                          ‚Üì
    ‚îÇ                                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                                                  ‚Üì                 ‚Üì
    ‚îÇ                                          [Success]          [Error]
    ‚îÇ                                                  ‚Üì                 ‚Üì
    ‚îÇ                                          [Completed]        [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚îÇ                                                  ‚Üì
    ‚îÇ                                          [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    ‚îÇ
    ‚îî‚îÄ‚Üí [–û–±—Ä–∞–±–æ—Ç–∫–∞ callback] ‚îÄ‚îÄ‚Üí [–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
```

### 4.2. –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

```
[Starting]
    ‚Üì
[Downloading: 0%]
    ‚Üì
[Downloading: 10%]
    ‚Üì
[Downloading: 20%]
    ‚Üì
...
    ‚Üì
[Downloading: 100%]
    ‚Üì
[Uploading]
    ‚Üì
    ‚îú‚îÄ‚Üí [Success] ‚îÄ‚îÄ‚Üí [Completed] ‚îÄ‚îÄ‚Üí [–ö–æ–Ω–µ—Ü]
    ‚îî‚îÄ‚Üí [Error] ‚îÄ‚îÄ‚Üí [–ö–æ–Ω–µ—Ü]
```

### 4.3. –î–∏–∞–≥—Ä–∞–º–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏

```
[–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞]
    ‚Üì
[–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏]
    ‚Üì
    ‚îú‚îÄ‚Üí [–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞]
    ‚îî‚îÄ‚Üí [–ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞]
            ‚Üì
    [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–º–∞—Ñ–æ—Ä–∞]
            ‚Üì
            ‚îú‚îÄ‚Üí [–í—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã] ‚îÄ‚îÄ‚Üí [–û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–∞]
            ‚îî‚îÄ‚Üí [–°–ª–æ—Ç —Å–≤–æ–±–æ–¥–µ–Ω]
                    ‚Üì
            [–ó–∞—Ö–≤–∞—Ç —Å–ª–æ—Ç–∞]
                    ‚Üì
            [–ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏]
                    ‚Üì
            [–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–ª–æ—Ç–∞]
                    ‚Üì
            [–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞]
```

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### Rate Limiting
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: **30 —Å–µ–∫—É–Ω–¥**

### Queue Processing
- –ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: **5**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—á–µ—Ä–µ–¥–∏: **100 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥**

### Download
- –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞: **10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥)**
- –¢–∞–π–º–∞—É—Ç yt-dlp –∫–æ–º–∞–Ω–¥—ã: **120 —Å–µ–∫—É–Ω–¥ (2 –º–∏–Ω—É—Ç—ã)**

### Retry Logic
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞: **3**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: **10 —Å–µ–∫—É–Ω–¥**
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è dispatcher: **5**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ dispatcher: **5 —Å–µ–∫—É–Ω–¥**
- –ë–∞–∑–∞ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏: **2**

### Animation
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏: **500 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏: **50 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥**

### Network
- –¢–∞–π–º–∞—É—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤: **300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)**

### Progress Message
- –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: **10 —Å–µ–∫—É–Ω–¥**

### Validation
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ URL: **2048 —Å–∏–º–≤–æ–ª–æ–≤**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: **50 MB**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∞—É–¥–∏–æ: **49 MB**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ: **49 MB**

---

## 6. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–µ—Ç—å—é –∏ —Ñ–∞–π–ª–∞–º–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tokio` –¥–ª—è async runtime
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (yt-dlp) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ `spawn_blocking`

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å
- –î–æ 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ —á–µ—Ä–µ–∑ —Å–µ–º–∞—Ñ–æ—Ä
- –ö–∞–∂–¥–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π async –∑–∞–¥–∞—á–µ
- –û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `anyhow::Result` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–æ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
- –†–µ–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∞—É–¥–∏–æ (–ø–∞—Ä—Å–∏–Ω–≥ –≤—ã–≤–æ–¥–∞ yt-dlp)
- –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –≤–∏–¥–µ–æ (10% ‚Üí 90%)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥

### Rate Limiting
- –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–∫ –≤ –ø–∞–º—è—Ç–∏ (HashMap)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥

---

## 7. –ü—Ä–∏–º–µ—Ä—ã –ø–æ—Ç–æ–∫–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `https://youtube.com/watch?v=...`
2. –ë–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç URL –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit
3. –ü–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `mp3`)
4. –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `"–Ø –î–æ—Ä–∞, –ø–æ–ø—Ä–æ–±—É—é —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫! üéµ –¢–µ—Ä–ø–µ–Ω–∏–µ!"`
6. –û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞*\n\n‚è≥ –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ..."`
8. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞*\n\nüì• –°–∫–∞—á–∏–≤–∞—é: 50%\n[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë]"`
9. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞*\n\nüì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞..."`
10. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
11. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞*\n\n‚úÖ –°–∫–∞—á–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ –∑–∞ 45 —Å–µ–∫—É–Ω–¥!"`
12. –ß–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –æ—á–∏—â–∞–µ—Ç –¥–æ: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞*"`
13. –ß–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç —É–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

### –ü—Ä–∏–º–µ—Ä 2: Rate Limit

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL
2. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit
3. –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å –±—ã–ª 15 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥ (< 30 —Å–µ–∫—É–Ω–¥)
4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `"–Ø –î–æ—Ä–∞, —á–∞–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ —è –Ω–µ —Å–º–æ–≥—É —Å–∫–∞—á–∞—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ —Å–µ–π—á–∞—Å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥."`
5. –ó–∞–¥–∞—á–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

### –ü—Ä–∏–º–µ—Ä 3: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `/mode`
2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å —Ç–µ–∫—É—â–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç `"üì• –¢–∏–ø –∑–∞–≥—Ä—É–∑–∫–∏: üéµ MP3"`
4. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç `"üé¨ MP4 ‚úì"`
6. –ë–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –≤ –ë–î –Ω–∞ `mp4`
7. –ë–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ–Ω—é, –ø–æ–∫–∞–∑—ã–≤–∞—è –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä —Å ‚úì
8. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ñ–æ—Ä–º–∞—Ç `mp4`

### –ü—Ä–∏–º–µ—Ä 4: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL
2. –ë–æ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
3. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞
4. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)
5. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∏–∫–µ—Ä –æ—à–∏–±–∫–∏
6. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å üò¢ –Ø –Ω–∞–ø–∏—Å–∞–ª–∞ –°—Ç—ç–Ω—É"`
7. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: `"üéµ *–ù–∞–∑–≤–∞–Ω–∏–µ*\n\n‚ùå –û—à–∏–±–∫–∞: [–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏]"`

---

## 8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞ Doradura. –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Å–∏—Å—Ç–µ–º–æ–π –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è rate limiting, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

